{% load staticfiles %}
<div ng-controller="CharCtrl">
    <div class="row fill-height">
        <div id="sidebar" class="col-md-2 list-view">
            <h3>Characters</h3>
            <!-- SIDEBAR FOR LIST OF CHARACTERS -->
            <form>
                <div ng-repeat="character in getChars()" class="padded-top-bottom-10">
                    <div ng-if="character.id > 0">
                        <span>Name: </span><input type="text" ng-model="character.name">
                        <span class="glyphicon glyphicon-edit clickable hover-fade" ng-click="editChar(character)"></span>
                        <sweet-delete variable="character" container="getChars()" confirm="true"></sweet-delete>
                        <hr/>
                    </div>
                </div>
                <button class="btn btn-primary" ng-click="addChar()">Add new character</button>
            </form>
        </div>

        <!-- AREA FOR EDITING CHARACTERS -->
        <div id="main" ng-show="editVisible">
            <div ng-repeat="character in getChars() | filter : {id: getCurrChar().id}">
                <div ng-if="character.id > 0">
                    <h3>{$character.name$}</h3>

                    <form>
                        <div class="padded-top-bottom-10" ng-repeat="state in getStates(character)">
                            <strong>States</strong>

                            <div class="row">
                                <div class="col-sm-1">
                                    <span>Name:</span>
                                </div>
                                <div class="col-sm-4">
                                    <input type="text" ng-model="state.name"/>
                                    <sweet-delete variable="state" container="getStates(character)"></sweet-delete>
                                </div>
                            </div>
                            <div class="padded-top-bottom-10">
                                <span>Active Conversation: </span>
                                <select ng-model="state.convo"
                                        ng-options="convo.id as convo.name for convo in getConvos()">
                                    <option value="">Select Convo</option>
                                </select>
                            </div>
                        </div>
                        <button class="btn btn-primary" ng-click="addState(character)">Add new state</button>

                        <div class="padded-top-bottom-10">
                            <div class="row">
                                <div class="col-sm-1">
                                    <span>Items</span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="row" ng-repeat="item in itemsForCurrentChar()">
                                        <div>
                                            <span class="col-sm-2">{$item.name$}</span>
                                        </div>
                                        <div class="col-sm-2">
                                            <sweet-delete variable="item.id"
                                                          container="character.items"></sweet-delete>
                                        </div>
                                    </div>
                                    <div class="row padded-top-bottom-5">
                                        <div class="col-sm-2">
                                            <select class="input-sm" ng-model="selectedItem"
                                                    ng-options="item.id as item.name for item in getUnusedItems()"
                                                    title="Items">
                                            </select>
                                        </div>
                                        <div class="col-sm-2">
                                            <button class="btn btn-primary" ng-click="addSelectedItem()">Add Item
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <hr/>
                <table style="text-align:center;padding:10px;">
                    <tr>
                        <td></td>
                        <td colspan="2">
                            <div ng-repeat="c in getTexturesForComponent(getCurrChar(), 'HEAD')">
                                <img class="thumbnail" src="{$c.imageUrl$}"/>
                                <span>{$img.componentType$}</span>
                            </div>
                            <button class="btn btn-default" data-toggle="modal" data-target="#component-modal"
                                    ng-click="editBodyPart('HEAD')">HEAD
                            </button>
                        </td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>
                            <div ng-repeat="c in getTexturesForComponent(getCurrChar(), 'LEFT_ARM')">
                                <img class="thumbnail" src="{$c.imageUrl$}"/>
                            </div>
                            <button class="btn btn-default" data-toggle="modal" data-target="#component-modal"
                                    ng-click="editBodyPart('LEFT_ARM')">LEFT ARM
                            </button>
                        </td>
                        <td colspan="2">
                            <div ng-repeat="c in getTexturesForComponent(getCurrChar(), 'TORSO')">
                                <img class="thumbnail" src="{$c.imageUrl$}"/>
                            </div>
                            <button data-toggle="modal" data-target="#component-modal" class="btn btn-default"
                                    ng-click="editBodyPart('TORSO')">TORSO
                            </button>
                        </td>
                        <td>
                            <div ng-repeat="c in getTexturesForComponent(getCurrChar(), 'RIGHT_ARM')">
                                <img class="thumbnail" src="{$c.imageUrl$}"/>
                            </div>
                            <button class="btn btn-default" data-toggle="modal" data-target="#component-modal"
                                    ng-click="editBodyPart('RIGHT_ARM')">RIGHT ARM
                            </button>
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        <td colspan="2">
                            <div ng-repeat="c in getTexturesForComponent(getCurrChar(), 'PELVIS')">
                                <img class="thumbnail" src="{$c.imageUrl$}"/>
                            </div>
                            <button data-toggle="modal" data-target="#component-modal" class="btn btn-default"
                                    ng-click="editBodyPart('PELVIS')">PELVIS
                            </button>
                        </td>
                        <td></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>
                            <div ng-repeat="c in getTexturesForComponent(getCurrChar(), 'LEFT_LEG')">
                                <img class="thumbnail" src="{$c.texture.imageUrl$}"/>
                            </div>
                            <button class="btn btn-default" data-toggle="modal" data-target="#component-modal"
                                    ng-click="editBodyPart('LEFT_LEG')">LEFT LEG
                            </button>
                        </td>
                        <td>
                            <div ng-repeat="c in getTexturesForComponent(getCurrChar(), 'RIGHT_LEG')">
                                <img class="thumbnail" src="{$c.imageUrl$}"/>
                            </div>
                            <button class="btn btn-default" data-toggle="modal" data-target="#component-modal"
                                    ng-click="editBodyPart('RIGHT_LEG')">RIGHT LEG
                            </button>
                        </td>
                        <td></td>
                    </tr>
                </table>
            </div>
            <!-- MODAL WINDOW FOR PICKING/UPLOADING ASSETS -->
            <div class="modal fade" id="component-modal" ng-show="editBodyPartVisible">
                <div class="modal-content">
        <span>
            Pick asset for: {$currBodyPart$}
        </span>

                    <span>Name:</span>
                    <input type="text" ng-model="nameQuery" ng-change="queryChanged()"/>

                    <span>Tags(Comma Separated):</span>
                    <input type="text" ng-model="tagsQuery" ng-change="queryChanged()"/>

                    <table class="table table-striped">
                        <thead>
                        <tr>
                            <th></th>
                            <th class="h4">Name</th>
                            <th class="h4">Description</th>
                            <th class="h4">Tags</th>
                            <th class="h4">Components</th>
                        </tr>
                        </thead>
                        <tr ng-repeat="comp in componentSets">
                            <td>
                                <button class="btn btn-primary" data-dismiss="modal" ng-click="selectComponent(comp)">
                                    Select
                                </button>
                            </td>
                            <td>
                                <span>{$comp.name$}</span>
                            </td>
                            <td>
                                <span>{$comp.description$}</span>
                            </td>
                            <td>
                                <div ng-repeat="tag in comp.tags">
                                    <span>{$tag.value$}</span>
                                </div>
                            </td>
                            <td ng-repeat="img in comp.components">
                                <img class="thumbnail" src="{$img.texture.imageUrl$}"/>
                                <span>{$img.componentType$}</span>
                            </td>
                        </tr>
                    </table>
                    <hr/>
                    <button class="btn btn-default" data-dismiss="modal" ng-click="closeBodyPart()">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- In production use:
<script src="//ajax.googleapis.com/ajax/libs/angularjs/x.x.x/angular.min.js"></script>
-->